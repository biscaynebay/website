<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />

  <title>Biscayne Bay</title>

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Italianno&display=swap" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Merriweather&display=swap" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Barlow&display=swap" />
  <link rel="stylesheet" href="https://api.tiles.mapbox.com/mapbox-gl-js/v2.9.2/mapbox-gl.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.2/css/fontawesome.min.css" integrity="sha384-X8QTME3FCg1DLb58++lPvsjbQoCT9bp3MsUU3grbIny/3ZwUJkRNO8NPW6zqzuW9" crossorigin="anonymous">
  <script src="https://api.tiles.mapbox.com/mapbox-gl-js/v2.9.2/mapbox-gl.js"></script>

  <style>
   /* Works on Firefox */
  * {
    scrollbar-width: thin;
    scrollbar-color: #CFBBA0 #f8f6f1;
  }

  /* Works on Chrome, Edge, and Safari */
  *::-webkit-scrollbar {
    width: 15px;
  }

  *::-webkit-scrollbar-thumb {
    background-color: #CFBBA0;
    border-radius: 5px;
    border: 6px solid #f8f6f1;
  }

  #map {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
  }

  .overlay {
    width: 100%;
    height: 100%;
    position: absolute;
    left: 0;
    top: 0;
    background-color: rgba(0, 0, 0, .3);
    z-index: 90;
    opacity: 0;
    visibility: hidden;
    transition: all 200ms ease-in;
  }

  /* Show Nav */
  .show-drawer .drawer {
    left: 0;
  }

  .show-drawer .overlay {
    opacity: 1;
    visibility: visible;
  }

  /* Styling the content */

  .drawer {
    width: 400px;
    height: 100vh;
    background-color: #f8f6f1;
    left: 0px;
    top: 0;
    position: fixed;
    box-shadow: 0 2px 4px rgba(0, 0, 0, .6);
    transition: all 200ms ease-in-out;
    z-index: 99;
    /*overflow-x: hidden;*/
    overflow-y: auto;
  }


  .drawer .div {
    padding: 10px;
  }

  .drawer p {
    margin: 0;
    padding: 15px;
    font-family: "Barlow", sans-serif;
    text-align: center;
  }

  .drawer h3 {
    font-weight: 400;
    margin: 0;
    font-family: "Italianno", cursive;
    font-size: 3em;
    text-align: center;
    line-height: 1em;
    background: #ffffff;
    color: #78553a;
    padding: 10px;
    background-color: #f8f6f1;
  }

  .drawer h4 {
    margin: 0;
    padding: 10px;
    font-weight: 400;
  }

  .lgview {
    width: 100% - 400px;
    height: 100vh;
    background-color: #f8f6f1;
    left: 400px;
    top: 0;
    position: fixed;
    box-shadow: 0 2px 4px rgba(0, 0, 0, .6);
    transition: all 200ms ease-in-out;
    z-index: 99;
    /*overflow-x: hidden;*/
    overflow-y: auto;
  }
  .lgview .div {
    padding: 10px;
  }

  .lgview p {
    margin: 0;
    padding: 15px;
    font-family: "Barlow", sans-serif;
    text-align: center;
  }

  .lgview h3 {
    font-weight: 400;
    margin: 0;
    font-family: "Italianno", cursive;
    font-size: 3em;
    text-align: center;
    line-height: 1em;
    background: #ffffff;
    color: #78553a;
    padding: 10px;
    background-color: #f8f6f1;
  }

  .lgview h4 {
    margin: 0;
    padding: 10px;
    font-weight: 400;
  }



  .location-img {
    width: 380px;
    height: 200px;
    object-fit:contain;
  }

  .location-img-lg {
    width: 80%;
    height: 80%;
    object-fit:cover;
  }

  .button-container {
    display: flex;
    justify-content: center;
    align-items: center;
  }

  .view-more {
    margin: 0 auto;
    padding: 15px 32px;
    font-family: "Merriweather", serif;
    background-color: #78553a;
    border: none;
    text-align: center;
    text-decoration: none;
    font-size: 1em;
    color: white;
    margin: 10px;
  }

  .view-more:hover {
    background-color: #9d7d3f;
  }

  .drawer-header {
    display: flex;
    justify-content: flex-end
  }

  .button {
    box-sizing: content-box;
    width: 2em;
    height: 2em;
    color: #000;
    background: transparent url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' fill='%23000'%3e%3cpath d='M.293.293a1 1 0 011.414 0L8 6.586 14.293.293a1 1 0 111.414 1.414L9.414 8l6.293 6.293a1 1 0 01-1.414 1.414L8 9.414l-6.293 6.293a1 1 0 01-1.414-1.414L6.586 8 .293 1.707a1 1 0 010-1.414z'/%3e%3c/svg%3e") center/1.5em auto no-repeat;
    border: 0;
    border-radius: .25rem;
    opacity: .5;
    margin-top: 5px;
  }

  .compass {
    position: fixed;
    bottom: 30px;
    right: 10px;
    z-index: 1;
    width: 50px;
    height: 50px;
    padding: 50px;
    background-image:
      url("https://i.ibb.co/89zKmhr/u-http-www-pngall-com-wp-content-uploads-2017-03-Compass-Transparent.png");
    background-repeat: no-repeat, repeat;
    background-size: cover;
  }
  </style>
</head>

<body>
  <div class="compass"></div>
  <div id="map"></div>
  <script>
  var lorem = "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed pulvinar ex lacinia arcullamcorper, sed tempus arcu lacinia. Integer volutpat eros odio, eu vehicula eros pellentesque id. Nunc faucibus porta lobortis. Praesent nec diam ac lacus convallis cursus. Maecenas at congue nibh. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed pulvinar ex lacinia arcullamcorper, sed tempus arcu lacinia. Integer volutpat eros odio, eu vehicula eros pellentesque id. Nunc faucibus porta lobortis. Praesent nec diam ac lacus convallis cursus. Maecenas at congue nibh.  Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed pulvinar ex lacinia arcullamcorper, sed tempus arcu lacinia. Integer volutpat eros odio, eu vehicula eros pellentesque id. Nunc faucibus porta lobortis. Praesent nec diam ac lacus convallis cursus. Maecenas at congue nibh. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed pulvinar ex lacinia arcullamcorper, sed tempus arcu lacinia. Integer volutpat eros odio, eu vehicula eros pellentesque id. Nunc faucibus porta lobortis. Praesent nec diam ac lacus convallis cursus. Maecenas at congue nibh. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed pulvinar ex lacinia arcullamcorper, sed tempus arcu lacinia. Integer volutpat eros odio, eu vehicula eros pellentesque id. Nunc faucibus porta lobortis. Praesent nec diam ac lacus convallis cursus. Maecenas at congue nibh. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed pulvinar ex lacinia arcullamcorper, sed tempus arcu lacinia. Integer volutpat eros odio, eu vehicula eros pellentesque id. Nunc faucibus porta lobortis. Praesent nec diam ac lacus convallis cursus. Maecenas at congue nibh.  Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed pulvinar ex lacinia arcullamcorper, sed tempus arcu lacinia. Integer volutpat eros odio, eu vehicula eros pellentesque id. Nunc faucibus porta lobortis. Praesent nec diam ac lacus convallis cursus. Maecenas at congue nibh. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed pulvinar ex lacinia arcullamcorper, sed tempus arcu lacinia. Integer volutpat eros odio, eu vehicula eros pellentesque id. Nunc faucibus porta lobortis. Praesent nec diam ac lacus convallis cursus. Maecenas at congue nibh"

  /// utils ////////////////////////////////////////////////////////////////////

  const removeChildren = (node) => {
    console.log('node', node.childNodes.length)
    while (node.childNodes.length > 0) {
      node.removeChild(node.childNodes[0]);
    }
  };

  const Drawer = (title, image, body) => {
    elem = document.createElement('div');
    elem.className = 'drawer'
    const markup = `
    <div class="drawer-header">
      <button type="button" id="drawer-close" class="button"></button>
    </div>
    <img id="location-image" class="location-img" src="${image}">
    <h3 id="location-title">${title}</h3>
    <p id="location-body">${body}</p>
    <div class="button-container">
      <button id="detail-open" class="view-more">View More</button>
    </div>
    `;
    elem.innerHTML = markup;
    return elem;
  };

  const Detail = (title, image, body) => {
    elem = document.createElement('div');
    elem.className = 'lgview'
    const markup = `
    <div class="drawer-header">
      <button type="button" id="detail-close" class="button"></button>
    </div>
    <img class="location-img-lg" src="${image}">
    <h3 id="location-title">${title}</h3>
    <p id="location-body">${body}</p>
    `;
    elem.innerHTML = markup;
    return elem;
  };

  /// configs //////////////////////////////////////////////////////////////////

    mapboxgl.accessToken = 'pk.eyJ1IjoiY2hyaXN3a2VuZGFsbCIsImEiOiJjbDVsNXNlZTcwZ2xsM2JxaXB0Y201bnhwIn0.Ps5Pn0XKcxRfxVdggxiqrQ';
    layers = ['biscayne-bay-parks', 'biscayne-bay-archeological-sites', 'biscayne-bay-cultural-institution'];
    const bounds = [
         [-81.51223172286319, 24.621290094170632], // Southwest coordinates
         [-79.35826265105771, 27.64779362822521] // Northeast coordinates
     ];

    const map = new mapboxgl.Map({
      container: 'map',
      style: 'mapbox://styles/chriswkendall/cl5l5z512000015qhfnyn5rih',
      center: [-80.221, 25.618],
      zoom: 9.42,
      maxBounds: bounds
    });

    container = document.createElement('div');
    document.body.appendChild(container);

  /// handler //////////////////////////////////////////////////////////////////

  map.on('click', (e) => {
    removeChildren(container);
    for (const feature of map.queryRenderedFeatures(e.point, {layers: layers})) {
      const image = 'https://i.ibb.co/h9B6rph/cape-florida-sample.jpg';
      const drawer = Drawer(feature.properties.name, image, lorem);
      drawer.addEventListener('click', (e) => {
         console.log('drawer clicked', e)
        if (e.target.id === 'detail-open' || e.target.id === 'location-image') {
          const detail = Detail(feature.properties.name, image, lorem);
          detail.addEventListener('click', (e) => {
            if (e.target.id === 'detail-close') {
              container.removeChild(e.currentTarget)
            };
          });
          container.appendChild(detail)
        };
        if (e.target.id === 'drawer-close') {
          console.log('removing', container.children);
          removeChildren(container);
        };
      });
      container.appendChild(drawer);
    };
  });
  map.on('mousemove', function (e) {
    const features = map.queryRenderedFeatures(e.point, {layers: layers});
    console.log(features)
    map.getCanvas().style.cursor = features.length ? 'pointer' : '';
  });
  map.on('rotate', (e)=>{
    const direction = -map.getBearing()
    const compass   = document.getElementsByClassName('compass')[0];
    compass.style.transform = 'rotate(' + direction + 'deg)';
  });

  </script>
</body>
</body>

</html>
